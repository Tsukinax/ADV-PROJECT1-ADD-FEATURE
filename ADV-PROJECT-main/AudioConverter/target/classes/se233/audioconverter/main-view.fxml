<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.geometry.Insets?>
<?import javafx.scene.control.*?>
<?import javafx.scene.layout.*?>
<?import javafx.scene.text.Font?>

<BorderPane xmlns="http://javafx.com/javafx/21"
            xmlns:fx="http://javafx.com/fxml/1"
            fx:controller="se233.audioconverter.controller.MainViewController"
            prefHeight="600.0" prefWidth="800.0">

    <!-- Menu Bar -->
    <top>
        <MenuBar>
            <Menu text="File">
                <MenuItem text="Clear All" onAction="#onClear"/>
                <SeparatorMenuItem/>
                <MenuItem text="Exit" onAction="#onClose"/>
            </Menu>
            <Menu text="Help">
                <MenuItem text="About"/>
            </Menu>
        </MenuBar>
    </top>

    <!-- Main Content -->
    <center>
        <StackPane fx:id="mainStackPane">

            <!-- Stage 1: File Drop Zone -->
            <VBox fx:id="fileDropStage" spacing="20" alignment="CENTER"
                  style="-fx-padding: 40;">

                <Label text="Audio Converter"
                       style="-fx-font-size: 32; -fx-font-weight: bold;"/>

                <Label text="Drag and drop your audio files here"
                       style="-fx-font-size: 16; -fx-text-fill: gray;"/>

                <!-- Drop Zone -->
                <VBox fx:id="dropZone" alignment="CENTER" spacing="15"
                      style="-fx-border-color: #4CAF50; -fx-border-width: 3; -fx-border-style: dashed; -fx-border-radius: 10; -fx-background-color: #f9f9f9; -fx-background-radius: 10; -fx-padding: 60;"
                      prefWidth="500" prefHeight="300">

                    <Label text="📁" style="-fx-font-size: 72;"/>
                    <Label text="Drop audio files here"
                           style="-fx-font-size: 18; -fx-font-weight: bold;"/>
                    <Label text="Supported formats: MP3, WAV, M4A, FLAC"
                           style="-fx-text-fill: gray; -fx-font-size: 12;"/>

                    <HBox spacing="10" alignment="CENTER">
                        <Label text="or" style="-fx-text-fill: gray;"/>
                        <Button text="Browse Files"
                                style="-fx-background-color: #4CAF50; -fx-text-fill: white; -fx-font-weight: bold; -fx-padding: 10 20;"
                                onAction="#onBrowseFiles"/>
                    </HBox>
                </VBox>

                <!-- File List Preview -->
                <VBox fx:id="filePreviewBox" spacing="10" visible="false" managed="false"
                      style="-fx-background-color: white; -fx-border-color: #cccccc; -fx-border-width: 1; -fx-border-radius: 5; -fx-padding: 15;"
                      prefWidth="500">
                    <HBox alignment="CENTER_LEFT" spacing="10">
                        <Label text="Files Selected:" style="-fx-font-weight: bold;"/>
                        <Label fx:id="fileCountLabel" text="0 files"/>
                        <Region HBox.hgrow="ALWAYS"/>
                        <Button text="Clear" onAction="#onClearFromStage1"
                                style="-fx-background-color: #f44336; -fx-text-fill: white;"/>
                    </HBox>
                    <ListView fx:id="filePreviewList" prefHeight="150"/>
                </VBox>

                <!-- Next Button -->
                <Button fx:id="nextButton" text="Next: Configure Settings"
                        disable="true"
                        prefWidth="250" prefHeight="45"
                        style="-fx-background-color: #4CAF50; -fx-text-fill: white; -fx-font-size: 16; -fx-font-weight: bold;"
                        onAction="#onNextToConfig"/>
            </VBox>

            <!-- Stage 2: Configuration -->
            <VBox fx:id="configStage" spacing="15" visible="false" managed="false"
                  style="-fx-padding: 20;">

                <!-- Header with Back Button -->
                <HBox alignment="CENTER_LEFT" spacing="15">
                    <Button text="← Back" onAction="#onBackToFiles"
                            style="-fx-background-color: #757575; -fx-text-fill: white;"/>
                    <VBox>
                        <Label text="Configure Conversion Settings"
                               style="-fx-font-size: 20; -fx-font-weight: bold;"/>
                        <Label fx:id="configFileCountLabel" text="0 files selected"
                               style="-fx-text-fill: gray;"/>
                    </VBox>
                </HBox>

                <Separator/>

                <!-- Scrollable Configuration Area -->
                <ScrollPane fitToWidth="true" VBox.vgrow="ALWAYS"
                            style="-fx-background: white; -fx-border-color: transparent;">
                    <VBox spacing="15" style="-fx-padding: 10;">

                        <!-- Output Format -->
                        <VBox spacing="8" style="-fx-background-color: #f5f5f5; -fx-padding: 15; -fx-background-radius: 5;">
                            <Label text="Output Format"
                                   style="-fx-font-weight: bold; -fx-font-size: 14;"/>
                            <HBox spacing="10" alignment="CENTER_LEFT">
                                <Label text="Format:" minWidth="120"/>
                                <ComboBox fx:id="formatComboBox" prefWidth="200"/>
                                <Label fx:id="formatInfoLabel" text=""
                                       style="-fx-text-fill: gray; -fx-font-style: italic;"/>
                            </HBox>
                        </VBox>

                        <!-- Preset Selection -->
                        <VBox spacing="8" style="-fx-background-color: #E8F5E9; -fx-padding: 15; -fx-background-radius: 5;">
                            <Label text="Quick Presets"
                                   style="-fx-font-weight: bold; -fx-font-size: 14;"/>
                            <HBox spacing="10" alignment="CENTER_LEFT">
                                <Label text="Load Preset:" minWidth="120"/>
                                <ComboBox fx:id="presetComboBox" prefWidth="250" promptText="Choose a preset..."/>
                                <Button fx:id="loadPresetButton" text="Load"
                                        style="-fx-background-color: #4CAF50; -fx-text-fill: white;"/>
                            </HBox>
                            <Label fx:id="presetDescriptionLabel" text=""
                                   wrapText="true"
                                   style="-fx-text-fill: #666; -fx-font-size: 11; -fx-padding: 5 0 0 120;"/>
                        </VBox>

                        <!-- Quality Settings (for MP3, M4A) -->
                        <VBox fx:id="bitrateSettingsBox" spacing="8"
                              style="-fx-background-color: #f5f5f5; -fx-padding: 15; -fx-background-radius: 5;">
                            <Label text="Quality Settings"
                                   style="-fx-font-weight: bold; -fx-font-size: 14;"/>

                            <!-- Quality Presets (always visible) -->
                            <VBox spacing="5">
                                <HBox spacing="10" alignment="CENTER_LEFT">
                                    <Label text="Quality Preset:" minWidth="120"/>
                                    <Label fx:id="qualityLabel" text="Good (192 kbps)"
                                           style="-fx-font-weight: bold;"/>
                                </HBox>
                                <HBox spacing="10" alignment="CENTER_LEFT">
                                    <Label text="" minWidth="120"/>
                                    <Slider fx:id="qualitySlider" prefWidth="400"/>
                                </HBox>
                            </VBox>
                        </VBox>

                        <!-- WAV Quality Settings (Sample Rate based) -->
                        <VBox fx:id="wavQualityBox" spacing="8" visible="false" managed="false"
                              style="-fx-background-color: #f5f5f5; -fx-padding: 15; -fx-background-radius: 5;">
                            <Label text="Quality Settings"
                                   style="-fx-font-weight: bold; -fx-font-size: 14;"/>

                            <VBox spacing="5">
                                <HBox spacing="10" alignment="CENTER_LEFT">
                                    <Label text="Quality:" minWidth="120"/>
                                    <Label fx:id="wavQualityLabel" text="DVD (48000 Hz)"
                                           style="-fx-font-weight: bold;"/>
                                </HBox>
                                <HBox spacing="10" alignment="CENTER_LEFT">
                                    <Label text="" minWidth="120"/>
                                    <Slider fx:id="wavQualitySlider" min="0" max="3" value="2"
                                            majorTickUnit="1" minorTickCount="0"
                                            showTickMarks="true" showTickLabels="true"
                                            snapToTicks="true" prefWidth="400"/>
                                </HBox>
                            </VBox>
                        </VBox>

                        <!-- Advanced Settings -->
                        <VBox spacing="10">
                            <CheckBox fx:id="showAdvancedCheckBox" text="Show Advanced Settings"
                                      style="-fx-font-weight: bold;"/>

                            <VBox fx:id="advancedSettingsBox" spacing="10" visible="false" managed="false"
                                  style="-fx-background-color: #f5f5f5; -fx-padding: 15; -fx-background-radius: 5;">

                                <Label text="Advanced Audio Settings"
                                       style="-fx-font-weight: bold; -fx-font-size: 14;"/>

                                <!-- Sample Rate -->
                                <HBox spacing="10" alignment="CENTER_LEFT">
                                    <Label text="Sample Rate:" minWidth="120"/>
                                    <ComboBox fx:id="sampleRateComboBox" prefWidth="200"/>
                                </HBox>

                                <!-- Channels -->
                                <HBox spacing="10" alignment="CENTER_LEFT">
                                    <Label text="Channels:" minWidth="120"/>
                                    <ComboBox fx:id="channelsComboBox" prefWidth="200"/>
                                </HBox>

                                <Separator/>

                                <!-- Bitrate Mode (MP3 and M4A) -->
                                <VBox fx:id="bitrateModeBox" spacing="8" visible="false" managed="false">
                                    <Label fx:id="bitrateModeLabel" text="Bitrate Mode"
                                           style="-fx-font-weight: bold;"/>

                                    <HBox fx:id="bitrateModeRadioBox" spacing="10" alignment="CENTER_LEFT">
                                        <Label text="Mode:" minWidth="120"/>
                                        <RadioButton fx:id="constantBitrateRadio" text="Constant Bitrate (CBR)"
                                                     selected="true">
                                            <toggleGroup>
                                                <ToggleGroup fx:id="bitrateToggleGroup"/>
                                            </toggleGroup>
                                        </RadioButton>
                                        <RadioButton fx:id="variableBitrateRadio" text="Variable Bitrate (VBR)"
                                                     toggleGroup="$bitrateToggleGroup"/>
                                    </HBox>

                                    <!-- CBR Bitrate Selection -->
                                    <VBox fx:id="cbrBitrateBox" spacing="5">
                                        <HBox spacing="10" alignment="CENTER_LEFT">
                                            <Label text="Bitrate:" minWidth="120"/>
                                            <ComboBox fx:id="bitrateComboBox" prefWidth="200"/>
                                            <Label text="kbps" style="-fx-text-fill: gray;"/>
                                        </HBox>
                                    </VBox>

                                    <!-- VBR Quality Slider (0-5) -->
                                    <VBox fx:id="vbrQualityBox" spacing="5" visible="false" managed="false">
                                        <HBox spacing="10" alignment="CENTER_LEFT">
                                            <Label text="VBR Quality:" minWidth="120"/>
                                            <Label fx:id="vbrQualityLabel" text="2 (Normal)"
                                                   style="-fx-font-weight: bold;"/>
                                        </HBox>
                                        <HBox spacing="10" alignment="CENTER_LEFT">
                                            <Label text="" minWidth="120"/>
                                            <Slider fx:id="vbrQualitySlider" min="0" max="5" value="2"
                                                    majorTickUnit="1" minorTickCount="0"
                                                    showTickMarks="true" showTickLabels="true"
                                                    snapToTicks="true" prefWidth="300"/>
                                            <Label text="(0=Best, 5=Smallest)" style="-fx-text-fill: gray; -fx-font-size: 10;"/>
                                        </HBox>
                                    </VBox>
                                </VBox>
                            </VBox>
                        </VBox>

                        <!-- Files to Convert -->
                        <VBox spacing="8" style="-fx-background-color: #f5f5f5; -fx-padding: 15; -fx-background-radius: 5;">
                            <Label text="Files to Convert"
                                   style="-fx-font-weight: bold; -fx-font-size: 14;"/>
                            <ListView fx:id="fileListView" prefHeight="150"
                                      style="-fx-border-color: #cccccc; -fx-border-width: 1;"/>
                        </VBox>
                    </VBox>
                </ScrollPane>

                <!-- Progress Area -->
                <VBox spacing="8" style="-fx-background-color: #f9f9f9; -fx-padding: 15; -fx-background-radius: 5;">
                    <Label text="Progress:" style="-fx-font-weight: bold;"/>
                    <ProgressBar fx:id="progressBar" prefWidth="Infinity" prefHeight="25"/>
                    <Label fx:id="statusLabel" text="Ready" style="-fx-text-fill: gray;"/>
                </VBox>

                <!-- Action Buttons -->
                <HBox spacing="15" alignment="CENTER">
                    <Button fx:id="convertButton" text="Start Conversion"
                            prefWidth="200" prefHeight="45"
                            style="-fx-background-color: #4CAF50; -fx-text-fill: white; -fx-font-size: 16; -fx-font-weight: bold;"/>
                    <Button fx:id="clearButton" text="Clear All"
                            prefWidth="150" prefHeight="45"
                            style="-fx-background-color: #f44336; -fx-text-fill: white; -fx-font-size: 14; -fx-font-weight: bold;"/>
                </HBox>
            </VBox>

        </StackPane>
    </center>

    <!-- Footer -->
    <bottom>
        <HBox style="-fx-background-color: #f0f0f0; -fx-padding: 10;" alignment="CENTER">
            <Label text="Audio Converter v1.0 | Supports: MP3, WAV, M4A, FLAC"
                   style="-fx-text-fill: gray; -fx-font-size: 11;"/>
        </HBox>
    </bottom>
</BorderPane>
